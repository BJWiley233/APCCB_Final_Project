<!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <title>Project</title>
        
        <link rel="stylesheet" href="js/jQuery-Multiple-Select-Plugin-For-Bootstrap-Bootstrap-Multiselect/docs/css/bootstrap-4.5.2.min.css" type="text/css">
        <link rel="stylesheet" href="js/jQuery-Multiple-Select-Plugin-For-Bootstrap-Bootstrap-Multiselect/docs/css/bootstrap-example.min.css" type="text/css">
        <link rel="stylesheet" href="js/jQuery-Multiple-Select-Plugin-For-Bootstrap-Bootstrap-Multiselect/docs/css/prettify.min.css" type="text/css">
        <link rel="stylesheet" href="js/jQuery-Multiple-Select-Plugin-For-Bootstrap-Bootstrap-Multiselect/docs/css/fontawesome-5.15.1-web/all.css" type="text/css">
        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

        <script type="text/javascript" src="js/jQuery-Multiple-Select-Plugin-For-Bootstrap-Bootstrap-Multiselect/docs/js/jquery-2.1.3.min.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <script type="text/javascript" src="js/jQuery-Multiple-Select-Plugin-For-Bootstrap-Bootstrap-Multiselect/docs/js/bootstrap.bundle-4.5.2.min.js"></script>
        <script type="text/javascript" src="js/jQuery-Multiple-Select-Plugin-For-Bootstrap-Bootstrap-Multiselect/docs/js/prettify.min.js"></script>

        <link rel="stylesheet" href="js/jQuery-Multiple-Select-Plugin-For-Bootstrap-Bootstrap-Multiselect/dist/css/bootstrap-multiselect.css" type="text/css">
        <script type="text/javascript" src="js/jQuery-Multiple-Select-Plugin-For-Bootstrap-Bootstrap-Multiselect/dist/js/bootstrap-multiselect.js"></script>
        <link href="css/bootstrap.min.css" type="text/css" rel="stylesheet">
        <link href="css/other.css" type="text/css" rel="stylesheet">
        <link href="css/project_search.css" type="text/css" rel="stylesheet">
 
        
    </head>
    <body>
      <h1 style="padding-left:5px;">Protein blast to drug leads</h1>
        
        <form class="form" id='blast_seq' name='blast_seq' method='post' action='http://localhost/cgi-bin/project_blast.cgi'>
        <!-- for BFX3 server -->
        <!-- <form class="form" id='blast_seq' name='blast_seq' method='post' action='project_blast.cgi'>  -->
          <div class="wrapper">
            <!-- column is first number for grid class and row is second -->
            <div class="column1_1"> 
              <div id="select_container">
                <label class="control-label" id="taxonomy" for="taxids">Select a/multiple species:</label>     
                <select id="organisms" multiple="multiple" name="organisms" style="height:50px;overflow-y:scroll;">
                  <optgroup label="Primates">
                      <option value="9606">Homo sapiens</option>
                      <option value="9598">Pan troglodytes</option>
                  </optgroup>
                  <optgroup label="Other Complex Eukaryotes">
                    <option value="9913">Bos taurus</option>
                    <option value="7955">Danio rerio</option>
                </optgroup>
                  <optgroup label="Plant">
                    <option value="3702">Arabidopsis thaliana</option>
                    <option value="50225">Taraxacum officinale</option>
                  </optgroup>
                  <optgroup label="Insect">
                    <option value="7227">Drosophila melanogaster</option>
                    <option value="7460">Apis mellifera</option>
                  </optgroup>
                  <optgroup label="Rodent">
                      <option value="10090">Mus musculus</option>
                      <option value="10116">Rat</option>
                      <option value="10029">Chinese Hamster</option>
                  </optgroup>
                  <optgroup label="Yeast">
                    <option value="559292">Saccharomyces cerevisia</option>
                    <option value="4896">Saccharomyces pombe</option>
                  </optgroup>
                  <optgroup label="Bacteria">
                    <option value="83333">Escherichia coli</option>
                    <option value="28901">Salmonella enterica</option>
                    <option value="210">Helicobacter pylori</option>
                </select>
              </div>
            </div>
            <div class="column2_1">
              <label class="control-label" id="taxonomy_manual" for="taxids">Or enter taxonomy ids in comma separated list:</label> 
              <input id="taxid_manual" type="text" name="taxid_manual" style="height:37px" placeholder="9606,7227,10090,559292">
            </div>
            <!-- column1 row 2 spreads 2 columns -->
            <div class="column1_2">
              <div id="search_container">
                <label class="control-label" id="peptide_entry" for="peptide_entry">Enter peptide sequence in fasta format (>):</label>
                <textarea rows="15" cols="60" id="fasta_entered" type="text" name="fasta_entered" target = "_blank" placeholder=">sp|P80162|CXCL6_HUMAN C-X-C motif chemokine 6 OS=Homo sapiens OX=9606 GN=CXCL6 PE=1 SV=4 MSLPSSRAARVPGPSGSLCALLALLLLLTPPGPLASAGPVSAVLTELRCTCLRVTLRVNPKTIGKLQVFPAGPQCSKVEVVASLKNGKQVCLDPEAPFLKKVIQKILDSGNKKN"></textarea>
                <div>
                  <br>
                  <label class="control-label" id="title" for="title">Enter a Job Title/Name for fasta:</label>
                  <input id="job_title" type="text" name="job_title" placeholder="name_without_fasta_ext">  
                </div>
                <input id="blast1" type="submit" value="Blast">
              </div>
            </div>

            <div class="column5_2">  
                <div>
                  <span style="margin-right: 30px;">Enter a UniProt(SwissProt) ID:</span>
                  <span style="margin-right: 30px;">Start (optional):</span>
                  <span>End (optional):</span>
                </div>
                <div class="your-class">
                  <input style="display:block" id="uniprot_id" type="text" name="uniprot_id" placeholder="P00533, EGFR, Epidermal, Q01279">
                  <span><input class="resi" style="display:block" id="start_resi" type="text" name="start_resi" placeholder="1"></span>
                  <input class="resi" style="display:block" id="end_resi" type="text" name="end_resi">
                </div>
                <br>
                <br>
                <div>
                  <input id="blast2" type="submit" value="Blast">
                </div>
            </div>

            <div class="column3_2">
              <figure>
                <img src="img/arrow2.png" alt="my img"/>
                <figcaption style="text-align: center;"> Or ... </figcaption>
              </figure>
            </div>

          </div> <!--wrapper-->
          
        </form>


    </body>
    <script type="text/javascript">
      $(document).ready( function() {
        $('#organisms').multiselect({
          enableClickableOptGroups: true,
          maxHeight: 450 
        });
        // let's do at least some error input checking
        // https://www.biostars.org/p/47203/
        $('#blast1').on("click",function() {
          if ($("#end_resi").val().length > 0) {
            alert("You might have accidently inserted an end value for UniProt search?\n You can probably ignore the next warning if submitting your own sequence.")
            if (($("#end_resi").val() - $("#start_resi").val() + 1) <= 30) {
              // https://blast.ncbi.nlm.nih.gov/Blast.cgi
              alert("Warning: Your search parameters were adjusted to search for a short input sequence.\n You may get an error or page crash if your sequence is <= 10 residues long.")
            }
          }
          if ($("#fasta_entered").val().length > 0) {
            var firstChar = $('#fasta_entered').val().substr(0, 1);
            if (firstChar !== ">") {
              alert("Invalid fasta entry.  Must start with a '>'")
              // https://stackoverflow.com/questions/8664486/javascript-code-to-stop-form-submission
              // returnToPreviousPage();
              return false;
            }
            // make sure entered a sequence past the fasta header
            // https://www.webmasterworld.com/forum91/1851.htm
            var text = $("#fasta_entered").val().replace(/\s+$/g,"")
            var split = text.split("\n")
            if (split.length <= 1) {
              alert("You only added a fasta header but no sequence.  Please enter a sequence")
              return false;
            }
            return true;
          }
        }); 

        $('#blast2').on("click",function() {
          if ($("#end_resi").val().length > 0) {
            if (($("#end_resi").val() - $("#start_resi").val() + 1) <= 30) {
              alert("Warning: Your search parameters were adjusted to search for a short input sequence.\n You may get an error or page crash if your sequence is <= 10 residues long")
            }
          }
        }); 

        $("#uniprot_id").autocomplete({
          source: function(request, response){
            var frmStr = $('#blast_seq').serialize();
              $.ajax({
                type: "get",
                url: 'http://localhost/cgi-bin/autocomplete_project.cgi',
                // for BFX3 server
                // url: 'autocomplete_project.cgi',
                dataType: 'json',
                data: frmStr,
                success: function(data){
                  console.log(data)
                  response( $.map(data, function (item){
                    return {
                      label: item.label,
                      value: item.value
                      }
                  }));
                    
                },
                error: function(jqXHR, textStatus, errorThrown, data) {
                    console.log("Failed to return search help! textStatus: (" + textStatus +
                        ") and errorThrown: (" + errorThrown + ")");
                }  
                });
            }
        });
      }); 

    </script>
</html>